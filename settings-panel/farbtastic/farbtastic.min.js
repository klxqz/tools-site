!function(t){t.fn.farbtastic=function(a){return t.farbtastic(this,a),this},t.farbtastic=function(a,e){return a=t(a).get(0),a.farbtastic||(a.farbtastic=new t._farbtastic(a,e))},t._farbtastic=function(a,e){var r=this;t(a).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var o=t(".farbtastic",a);r.wheel=t(".wheel",a).get(0),r.radius=84,r.square=100,r.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&t("*",o).each(function(){if("none"!=this.currentStyle.backgroundImage){var a=this.currentStyle.backgroundImage;a=this.currentStyle.backgroundImage.substring(5,a.length-2),t(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+a+"')"})}}),r.linkTo=function(a){return"object"==typeof r.callback&&t(r.callback).unbind("keyup",r.updateValue),r.color=null,"function"==typeof a?r.callback=a:("object"==typeof a||"string"==typeof a)&&(r.callback=t(a),r.callback.bind("keyup",r.updateValue),r.callback.get(0).value&&r.setColor(r.callback.get(0).value)),this},r.updateValue=function(){this.value&&this.value!=r.color&&r.setColor(this.value)},r.setColor=function(t){var a=r.unpack(t);return r.color!=t&&a&&(r.color=t,r.rgb=a,r.hsl=r.RGBToHSL(r.rgb),r.updateDisplay()),this},r.setHSL=function(t){return r.hsl=t,r.rgb=r.HSLToRGB(t),r.color=r.pack(r.rgb),r.updateDisplay(),this},r.widgetCoords=function(a){var e=t(r.wheel).offset();return{x:a.pageX-e.left-r.width/2,y:a.pageY-e.top-r.width/2}},r.mousedown=function(a){document.dragging||(t(document).bind("mousemove",r.mousemove).bind("mouseup",r.mouseup),document.dragging=!0);var e=r.widgetCoords(a);return r.circleDrag=2*Math.max(Math.abs(e.x),Math.abs(e.y))>r.square,r.mousemove(a),!1},r.mousemove=function(t){var a=r.widgetCoords(t);if(r.circleDrag){var e=Math.atan2(a.x,-a.y)/6.28;0>e&&(e+=1),r.setHSL([e,r.hsl[1],r.hsl[2]])}else{var o=Math.max(0,Math.min(1,-(a.x/r.square)+.5)),n=Math.max(0,Math.min(1,-(a.y/r.square)+.5));r.setHSL([r.hsl[0],o,n])}return!1},r.mouseup=function(){t(document).unbind("mousemove",r.mousemove),t(document).unbind("mouseup",r.mouseup),document.dragging=!1},r.updateDisplay=function(){var a=6.28*r.hsl[0];t(".h-marker",o).css({left:Math.round(Math.sin(a)*r.radius+r.width/2)+"px",top:Math.round(-Math.cos(a)*r.radius+r.width/2)+"px"}),t(".sl-marker",o).css({left:Math.round(r.square*(.5-r.hsl[1])+r.width/2)+"px",top:Math.round(r.square*(.5-r.hsl[2])+r.width/2)+"px"}),t(".color",o).css("backgroundColor",r.pack(r.HSLToRGB([r.hsl[0],1,.5]))),"object"==typeof r.callback?(t(r.callback).css({backgroundColor:r.color,color:r.hsl[2]>.5?"#000":"#fff"}),t(r.callback).each(function(){this.value&&this.value!=r.color&&(this.value=r.color)})):"function"==typeof r.callback&&r.callback.call(r,r.color)},r.pack=function(t){var a=Math.round(255*t[0]),e=Math.round(255*t[1]),r=Math.round(255*t[2]);return"#"+(16>a?"0":"")+a.toString(16)+(16>e?"0":"")+e.toString(16)+(16>r?"0":"")+r.toString(16)},r.unpack=function(t){return 7==t.length?[parseInt("0x"+t.substring(1,3))/255,parseInt("0x"+t.substring(3,5))/255,parseInt("0x"+t.substring(5,7))/255]:4==t.length?[parseInt("0x"+t.substring(1,2))/15,parseInt("0x"+t.substring(2,3))/15,parseInt("0x"+t.substring(3,4))/15]:void 0},r.HSLToRGB=function(t){var a,e,r=t[0],o=t[1],n=t[2];return e=.5>=n?n*(o+1):n+o-n*o,a=2*n-e,[this.hueToRGB(a,e,r+.33333),this.hueToRGB(a,e,r),this.hueToRGB(a,e,r-.33333)]},r.hueToRGB=function(t,a,e){return e=0>e?e+1:e>1?e-1:e,1>6*e?t+(a-t)*e*6:1>2*e?a:2>3*e?t+(a-t)*(.66666-e)*6:t},r.RGBToHSL=function(t){var a,e,r,o,n,s,u=t[0],i=t[1],c=t[2];return a=Math.min(u,Math.min(i,c)),e=Math.max(u,Math.max(i,c)),r=e-a,s=(a+e)/2,n=0,s>0&&1>s&&(n=r/(.5>s?2*s:2-2*s)),o=0,r>0&&(e==u&&e!=i&&(o+=(i-c)/r),e==i&&e!=c&&(o+=2+(c-u)/r),e==c&&e!=u&&(o+=4+(u-i)/r),o/=6),[o,n,s]},t("*",o).mousedown(r.mousedown),r.setColor("#000000"),e&&r.linkTo(e)}}(jQuery);